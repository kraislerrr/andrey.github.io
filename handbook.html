<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Справочник команд Linux</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
    }
    
    header {
        background: #007BFF;
        color: #fff;
        padding: 10px 0;
        text-align: center;
    }
    
    nav {
        background: #bcbcbc
    }
    .mirror {
            display:inline-block;
            transform: rotate(180deg);
    }
    </style>
</head>
<body>
    <header>
        <h1>Справочник команд Linux</h1>
        <p>Полный справочник по основным командам Linux с примерами использования.</p>
    </header>
    <nav>
        <ul>
            <li><a href="#basic">Основные команды</a></li>
            <li><a href="#text">Работа с текстом</a></li>
            <li><a href="#processes">Управление процессами</a></li>
            <li><a href="#system">Системная информация</a></li>
            <li><a href="#network">Сетевые команды</a></li>
            <li><a href="#nftables">Права доступа</a></li>
            <li><a href="#knocking">Port Knocking</a></li>
            <li><a href="#pSQL">PostgreSQL</a></li>
        </ul>
    </nav>
    <main>
        <section id="basic">
            <h2>Основные команды</h2>
            <ul>
                <li><strong>ls -alh</strong> — вывод файлов.</li>
                <li><strong>rename 's/\.txt$/\.pdf/' *.txt</strong> — переименовать файлы.</li>
                <li><strong>!!</strong> — последняя команда.</li>
                <li><strong>!1</strong> — первая команда в history.</li>
            </ul>
        </section>
        <section id="text">
            <h2>Работа с текстом</h2>
            <ul>
                <li><strong>cat</strong> — вывод содержимого файла.</li>
                <li><strong>tac</strong> — реверс вывод содержимого файла.</li>
                <li><strong>grep</strong> — поиск текста в файлах.</li>
                <li><strong>wc</strong> — подсчет строк, слов и символов.</li>
                <li><strong>head -n 10</strong> — вывод первых строк.</li>
                <li><strong>tail -n 10</strong> — вывод последних строк.</li>
            </ul>
        </section>
        <section id="processes">
            <h2>Управление процессами</h2>
            <ul>
                <li><strong>ps -aux</strong> — вывод информации о процессах.</li>
                <li><strong>pidof</strong> — ID процесса.</li>
                <li><strong>top</strong> — мониторинг процессов в реальном времени.</li>
                <li><strong>kill</strong> — убить процесс по его идентификатору.</li>
                <li><strong>pkill</strong> — убить процесс по его имени.</li>
                <li><strong>killall</strong> —  убить все процессы с указанным именем.</li>
                <li><strong>systemctl status</strong> — состояние службы.</li>
                <li><strong>ulimit -u</strong> — лимит процессов.</li>
                <li><strong>apt list --installed</strong> — список установленных пакетов.</li>
                <li><strong>dpkg-query -l</strong> — список установленных пакетов.</li>
                <li><strong>whereis</strong> — полный путь к программе.</li>
                <li><strong>apt-get --purge remove {NAME}</strong> — удалить пакет.</li>
            </ul>
        </section>
        <section id="system">
            <h2>Системная информация</h2>
            <ul>
                <li><strong>df -h</strong> — информация о файловых системах.</li>
                <li><strong>du -s</strong> — информация о файловых системах.</li>
                <li><strong>free</strong> — информация о памяти.</li>
                <li><strong>vmstat</strong> — память.</li>
                <li><strong>cat /proc/meminfo</strong> — память.</li>
                <li><strong>uname</strong> — информация о системе.</li>
                <li><strong>iostat</strong> — запись на диск.</li>
                <li><strong>iotop</strong> — запись на диск по процессам.</li>
                <li><strong>smartctl -a /dev/sdc</strong> — SMART.</li>
                <li><strong>cat /proc/mdstat</strong> — RAID</li>
                <li><strong>cat /etc/*-release</strong> — дистрибутив.</li>
                
            </ul>
        </section>
        <section id="network">
            <h2>Сетевые команды</h2>
            <ul>
                <li><strong>ping</strong> — проверка доступности узла.</li>
                <li><strong>ifconfig / ip a</strong> — настройка сетевых интерфейсов.</li>
                <li><strong>netstat -tulpn</strong> — информация о сетевых соединениях.</li>
                <li><strong>ss -lntu</strong> — информация о сетевых соединениях.</li>

            </ul>
        </section>
        <section id="nftables">
            <h2>nftables стильно модно молодежно</h2>
            <ul>
                <li><strong>iptables-translate</strong> — iptables to nftables.</li>
                <li><strong>sudo systemctl enable nftables</strong> — включить автозагрузку службы.</li>
                <li><strong>sudo systemctl start nftables</strong> — запустить службу.</li>
                <li><strong>cat /etc/nftables.conf</strong> — При запуске служба читает конфиг.</li>
                <li><strong>sudo nft list ruleset</strong> — Просмотр действующих правил.</li>
                <li><strong>sudo nft add rule [family] [table] [chain] [expression] [action]</strong>
                     — Добавление правила.</li>
                <li><strong>sudo nft add rule inet filter input iifname lo counter accept</strong> 
                    — чтобы сервисы внутри нормально работали разрешить подключения к loopback.</li>
                <li><strong>sudo nft add chain inet filter input '{ policy drop; }'</strong> 
                    — После того как мы добавили все разрешающие правила в цепочке input, поменяем её политику на drop.</li>
                <li><strong>sudo nft add rule inet filter input ct state established,related counter accept</strong> 
                    — разрешить все ответные пакеты механизм connection tracking.</li>
                <li><strong>sudo nft delete rule inet filter input handle 8</strong> — удалить правило по его номеру.</li>

            </ul>
        </section>
        <section id="knocking">
            <h2>но странный стук зовет в дорогу</h2>
            <ul>
                <li><strong>apt install knockd</strong> — установим.</li>
                <li><strong>/etc/default/knockd</strong> — START_KNOCKD=1.</li>
                <li><strong>/etc/knockd.conf</strong> — конфигурации.</li>
                <li><strong>nft 'add rule ip filter INPUT iifname "eth0" ct state 
                    related,established counter accept'</strong> — включить.</li>
            </ul>
        </section>
        <section id="pSQL">
            <h2>Dumbo the Flying Elephant</h2>
            <ul>
                <li><strong>libicu-dev pkg-config zlib1g-dev bison flex libreadline-dev</strong> — нужны если собирать самому.</li>
                <li><strong>pg_lsclusters</strong> — список кластеров.</li>
                <li><strong>sudo pg_ctlcluster 16 main reload</strong> — Обновить конфигурацию.</li>
                <li><strong>/var/log/postgresql/postgresql-16-main.log</strong> — Журнал.</li>
                <li><strong>/etc/postgresql/16/main</strong> — конфигурации.</li>
                <li><strong>=> \! pwd</strong> — Из psql можно выполнять команды shell.</li>
                <li><strong>=> SHOW work_mem;</strong> — объём обработки запросов.<br>
                    <strong>=> SELECT name, setting, unit FROM pg_settings WHERE name = 'work_mem';<br>
                            => \dconfig work_mem</strong></li>
                <li><strong>=> ALTER SYSTEM SET work_mem TO '64MB';</strong> — если мы собираемся выполнить запрос, 
                    сортирующий большой объем данных, то для сеанса можно увеличить значение.</li>
                <li><strong>=> SELECT pg_reload_conf();</strong> — Чтобы изменение вступило в силу.<br>
                    <strong>sudo pg_ctlcluster 16 main reload</strong></li>
                <li><strong>=> ALTER SYSTEM RESET work_mem;</strong> — default.</li>
                <li><strong>psql -d база -U роль -h узел -p порт</strong> — параметры подключения.</li>
                <li><strong>=> \conninfo</strong> — текущее подключение.</li>
                <li><strong>=> SELECT name, setting, unit FROM pg_settings LIMIT 7;</strong>
                     — Формат с выравниванием используется по умолчанию.</li>

                <li>С помощью запроса SQL можно сформировать несколько других запросов SQL и записать их в файл, 
                    используя команду \o<br>
                    <strong>=> \a \t \pset fieldsep ''</strong> — меняем формат.<br>
                    <strong>=> \o dev1_tools.sql</strong> — указываем файл.<br>
                    <strong>=> SELECT format('SELECT %L AS tbl, count(*) FROM %I;', tablename, tablename)<br>
                    FROM pg_tables LIMIT 3;</strong><br>
                    <strong>=> \o \t \a</strong> — Вернем вывод на экран и восстановим форматирование по умолчанию.

                <li><strong>=> \i dev1_tools.sql</strong> — Выполнить команды из файла.</li>
                <li><strong>=> \set TEST Hi!</strong> — Установим переменную.</li>
                <li><strong>=> \echo :TEST</strong> — вызов переменной.</li>
                <li><strong>=> \unset TEST</strong> — сбросить значение.</li>
                <li><strong>=> \set top5 'SELECT tablename, pg_total_relation_size(schemaname||''.''||tablename) 
                    AS bytes FROM pg_tables ORDER BY bytes DESC LIMIT 5;'</strong> 
                    — запись в переменную запроса на получение списка пяти самых больших таблиц.<br>
                    <strong>=> :top5</strong> — выполнить запрос.</li>
                <li>Без параметров \set выдает значения всех переменных, включая встроенные.</li>
                <li><strong>\? variables</strong> — Справка по встроенным переменным.</li>
                <li><strong>shared_buffers</strong> — параметр, который устанавливает, сколько выделенной памяти будет 
                    использоваться для кэширования данных. Обычно под shared_buffers отдают львиную часть всей памяти — 
                    от 25 до 50%. Если сравнивать с MS SQL Server, то это близкий аналог buffer pool, размер которого 
                    ограничивается параметром max server memory. Обычно рекомендуют устанавливать 30% от общего объема.</li>
                <li><strong>temp_buffers</strong> — параметр, который задает максимальный объем памяти, выделяемый для 
                    временных таблиц (буферов) в каждом сеансе. т. е. временные таблицы, в отличии от MS SQL, могут 
                    кэшироваться в памяти, что позволяет избегать чтения с диска при работе с ними. При этом каждая таблица 
                    всегда имеет копию на диске, не важно хватило ли ей памяти в temp_buffers или нет.</li>
                <li><strong>maintenance_work_mem</strong> — параметр, который устанавливает объём оперативной памяти, 
                    выделенный для выполнения операций обслуживания базы данных: VACUUM, CREATE INDEX и ALTER TABLE, ADD 
                    FOREIGN KEY. Для расчета нужно понимать количество одновременных потоков (задач) обслуживания.</li>
                <li><strong>autovacuum_work_mem</strong> — параметр, который задает максимальный объём памяти, который будет 
                    использовать каждый рабочий процесс автоочистки. Входит в тот же кусок пирога, что и maintenance_work_mem 
                    и по умолчанию равен «-1», т.е. объём определяется значением maintenance_work_mem.</li>
                <li><strong>work_mem</strong> — параметр, который задаёт базовый максимальный объём памяти, который будет 
                    использоваться в рамках одного рабочего процесса (сессии) во внутренних операциях типа соединений, 
                    сортировки, группировки и т. п. при обработке запросов, прежде чем будут задействованы временные файлы 
                    на диске.</li>
            </ul>
        </section>
    </main>
    <footer>
        <p><span class="mirror">©</span> 9/17/1991 Справочник команд Linux</p>
    </footer>
</body>
</html>